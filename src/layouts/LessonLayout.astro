---
import Layout from "./Layout.astro";
import { getFormattedDate } from "@/utils/all";

const { frontmatter, lessons: rawLessons } = Astro.props;

type LessonItem = { title: string; url: string };
type LessonsType = Record<string, LessonItem[]>;

const lessons = rawLessons as LessonsType;
---

<Layout title={frontmatter.title}>
  <div class="flex flex-col lg:flex-row max-w-[1200px] mx-auto mt-14 px-4 lg:px-0 gap-8">

    <!-- Sidebar -->
    <aside class="hidden lg:block w-64 sticky top-20 h-[calc(100vh-80px)] overflow-y-auto border-r border-gray-200 pr-4">
      <h2 class="text-xl font-bold mb-4">Lezioni</h2>

      {Object.entries(lessons).map(([language, lessonList]) => (
        <div class="mb-4">
          <h3 class="font-semibold">{language}</h3>
          <ul class="space-y-2 pl-2">
            {lessonList.map(lesson => (
              <li>
                <a
                  href={lesson.url}
                  class={`block px-2 py-1 rounded hover:bg-gray-100 transition
                    ${lesson.url === frontmatter.url ? "bg-gray-200 font-semibold" : ""}`}
                >
                  {lesson.title}
                </a>
              </li>
            ))}
          </ul>
        </div>
      ))}
    </aside>

    <!-- Contenuto principale -->
    <main class="flex-1">
      <div class="mb-6">
        <h1 class="text-4xl font-bold">{frontmatter.title}</h1>
        <div class="flex flex-wrap gap-4 text-gray-600 text-sm">
          <span>✍️ {frontmatter.author}</span>
          {frontmatter.publishDate && <span>📅 {getFormattedDate(frontmatter.publishDate)}</span>}
          {frontmatter.subject && <span>📘 {frontmatter.subject}</span>}
          {frontmatter.category && <span>🏷️ {frontmatter.category}</span>}
        </div>
        {frontmatter.tags && frontmatter.tags.length > 0 && (
          <div class="mt-2 flex flex-wrap gap-2">
            {frontmatter.tags.map(tag => (
              <span class="bg-gray-200 px-2 py-1 rounded text-sm">{tag}</span>
            ))}
          </div>
        )}
      </div>

      <div class="prose prose-lg">
        <slot />
      </div>

      <div class="text-center mt-8">
        <a
          href="/informatica"
          class="bg-gray-100 px-5 py-3 rounded-md hover:bg-gray-200 transition"
        >
          ← Back to Informatica
        </a>
      </div>
    </main>
  </div>
</Layout>
